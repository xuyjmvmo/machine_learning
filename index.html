<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>六都房價預測系統 - 梯度提升樹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- 自己的 CSS -->
  <link rel="stylesheet" href="style.css" />

  <!-- PapaParse：讀取 CSV 用 -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- Chart.js：畫圖用 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- 主程式 -->
  <script defer src="script.js"></script>
</head>
<body>
  <div id="loader" class="loader-screen">
    <div class="loader-box">
      <div class="spinner"></div>
      <p class="loader-main">訓練梯度提升模型中...</p>
      <p class="loader-sub">正在建立 50 棵決策樹</p>
    </div>
  </div>

  <div class="page-bg">
    <div class="page-container">
      <!-- Header -->
      <header class="header">
        <h1 class="header-title">電梯大廈房價預測系統 - 梯度提升樹</h1>
        <p class="header-subtitle">使用 Gradient Boosting (類似 XGBoost) 進行預測</p>
        <p class="header-meta" id="headerMetaText">
          已訓練 0 棵決策樹 | 每棵深度: 3 層 | 學習率: 0.1
        </p>
      </header>

      <!-- Controls -->
      <section class="card controls-card">
        <div class="controls-grid">
          <div class="control-block">
            <label class="control-label">選擇城市</label>
            <select id="citySelect" class="select-input">
              <option value="台北市">台北市</option>
              <option value="新北市">新北市</option>
              <option value="桃園市">桃園市</option>
              <option value="台中市">台中市</option>
              <option value="台南市">台南市</option>
              <option value="高雄市">高雄市</option>
            </select>
          </div>
          <div class="control-block">
            <label class="control-label">
              預測季數：<span id="forecastLabel">8</span> 季
            </label>
            <input
              id="forecastRange"
              type="range"
              min="4"
              max="12"
              value="8"
              class="range-input"
            />
          </div>
        </div>

        <!-- 如果你不用 Electron / window.fs，可以改用這個上傳 CSV 的方式 -->
        <!--
        <div class="upload-row">
          <label class="control-label">上傳 merged_elevator_quarterly.csv</label>
          <input id="csvFileInput" type="file" accept=".csv" />
        </div>
        -->
      </section>

      <!-- Model Performance Cards -->
      <section class="metrics-grid">
        <div class="metric-card metric-purple">
          <div class="metric-label">模型準確度 (R² Score)</div>
          <div class="metric-value" id="r2Value">--%</div>
          <div class="metric-note">Gradient Boosting 集成學習準確率</div>
        </div>
        <div class="metric-card metric-pink">
          <div class="metric-label">平均絕對誤差 (MAE)</div>
          <div class="metric-value" id="maeValue">±-- 萬</div>
          <div class="metric-note" id="maeTreesNote">0 棵決策樹的集成預測誤差</div>
        </div>
      </section>

      <!-- Stats Cards -->
      <section class="stats-grid">
        <div class="stat-card stat-left">
          <div class="stat-label">當前單坪價格</div>
          <div class="stat-value" id="latestPriceValue">--</div>
          <div class="stat-note" id="latestPricePeriod">最新一期實際價格</div>
        </div>
        <div class="stat-card stat-middle">
          <div class="stat-label">預測價格</div>
          <div class="stat-value" id="futurePriceValue">--</div>
          <div class="stat-note" id="futurePricePeriod">-</div>
        </div>
        <div class="stat-card stat-right">
          <div class="stat-label">預測變化</div>
          <div class="stat-value" id="changeValue">--</div>
          <div class="stat-note">相較當前價格</div>
        </div>
      </section>

      <!-- Trend Chart -->
      <section class="card">
        <h2 class="section-title" id="trendTitle">歷史與預測趨勢</h2>
        <div class="chart-wrapper">
          <canvas id="trendChart"></canvas>
        </div>
        <p class="section-footnote">
          藍色實線為歷史數據，紫色虛線為梯度提升預測，灰色線為預測信心區間
        </p>
      </section>

      <!-- Feature Importance -->
      <section class="card">
        <h2 class="section-title">特徵重要性 - 決策樹最常用哪些特徵？</h2>
        <div class="chart-wrapper">
          <canvas id="featureChart"></canvas>
        </div>
        <div class="section-text">
          <p>📊 數值代表該特徵在 50 棵決策樹中被用於分割的頻率</p>
          <p>💡 使用率越高，表示該特徵對預測越重要</p>
        </div>
      </section>

      <!-- Tree Contributions -->
      <!--
      <section class="card">
        <h2 class="section-title">前 10 棵樹的貢獻度 - Boosting 學習過程</h2>
        <div class="chart-wrapper">
          <canvas id="treeChart"></canvas>
        </div>
        <div class="section-text">
          <p>📈 每棵樹逐步修正前面樹的預測誤差</p>
          <p>🌲 第 1 棵樹改善最多，後續樹逐步微調</p>
        </div>
      </section>
      -->

      <!-- Prediction Table -->
      <!--
      <section class="card">
        <h2 class="section-title">詳細預測數據</h2>
        <div class="table-wrapper">
          <table class="prediction-table">
            <thead>
              <tr>
                <th>期別</th>
                <th class="text-right">預測價格 (萬/坪)</th>
                <th class="text-right">模型信心度</th>
                <th class="text-right">較前期變化</th>
              </tr>
            </thead>
            <tbody id="predictionTableBody">
            </tbody>
          </table>
        </div>
      </section>
      -->

      <!-- Model Info -->
      <section class="card model-card">
        <h2 class="section-title white">🚀 梯度提升模型說明 (Gradient Boosting)</h2>
        <div class="model-grid">
          <div>
            <p class="model-subtitle">模型架構：</p>
            <ul class="model-list">
              <li>50 棵決策樹 (ensemble)</li>
              <li>每棵樹深度 3 層</li>
              <li>學習率 0.1 (learning rate)</li>
              <li>使用 MSE 作為分割標準</li>
            </ul>

            <p class="model-subtitle">使用的 8 個特徵：</p>
            <ul class="model-list small">
              <li>重貼現率、房貸餘額、M2</li>
              <li>餘屋數、六都均價、時間趨勢</li>
              <li>季節性因素 (sin/cos)</li>
            </ul>
          </div>
          <div>
            <p class="model-subtitle">工作原理：</p>
            <ul class="model-list">
              <li>第 1 棵樹：預測目標值</li>
              <li>第 2 棵樹：修正第 1 棵的誤差</li>
              <li>第 3 棵樹：修正前 2 棵的誤差</li>
              <li>...持續 50 次迭代</li>
              <li>最終預測 = Σ(所有樹 × 學習率)</li>
            </ul>
          </div>
        </div>
        <div class="model-footer">
          <p>
            <strong>💡 為什麼叫 "Gradient Boosting"？</strong><br />
            因為每棵新樹都在「梯度（gradient）」方向上「提升（boosting）」模型性能，
            逐步減少預測誤差，這個概念與 XGBoost 完全相同！
          </p>
        </div>
        <div class="model-footer small-box">
          <p>
            <strong>🔬 技術細節：</strong> 使用負梯度（殘差）作為新樹的訓練目標，
            通過迭代方式將多個弱學習器（淺層決策樹）組合成強學習器。
            每棵樹專注於修正前面所有樹的集體預測錯誤。
          </p>
        </div>
      </section>

      <!-- Comparison -->
      <section class="card">
        <h2 class="section-title">⚖️ Gradient Boosting vs 線性回歸比較</h2>
        <div class="compare-grid">
          <div class="compare-card purple">
            <h3>✅ Gradient Boosting 優勢</h3>
            <ul>
              <li>能捕捉非線性關係</li>
              <li>自動處理特徵交互作用</li>
              <li>對異常值更穩健</li>
              <li>不需要特徵標準化</li>
              <li>通常準確度更高</li>
            </ul>
          </div>
          <div class="compare-card blue">
            <h3>📊 線性回歸優勢</h3>
            <ul>
              <li>計算速度更快</li>
              <li>更容易解釋係數</li>
              <li>不容易過擬合</li>
              <li>需要的數據量較少</li>
              <li>預測更穩定</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer class="footer">
        <p>本預測使用梯度提升機器學習模型（Gradient Boosting Machine），類似 XGBoost 的原理</p>
        <p>透過 50 棵決策樹的集成學習，考慮 8 個經濟指標進行預測</p>
        <p>數據來源：2010Q1 - 2024Q4 電梯大廈交易資料</p>
      </footer>
    </div>
  </div>
</body>
</html>
